<!DOCTYPE html>
<html>
<head>
  <title>Test Stj√§rnkartan</title>
  <style>
    body {
      background-image: url('background.jpg');
      background-repeat: repeat-x;
      background-position: center top;
      background-color: #000000;
      margin: 0;
    }
    .star-map-container {
      overflow-x: auto;
      overflow-y: hidden;
      width: 100%;
      height: 600px;
    }
    .star-map-container object {
      width: 2800px;
      height: 600px;
    }
    text {
      font-family: Cochin, Georgia, Arial, sans-serif;
      font-size: 16px;
      fill: #999999;
    }
  </style>
</head>
<body>
  <div class="star-map-container">
    <object id="starMap" type="image/svg+xml" data="star-map.svg"></object>
  </div>
  <script>
    // Star images array
    const starImages = [
      'white-star.png',    // 0 stars
      'one-star.png',     // 1 star
      'two-stars.png',    // 2 stars
      'three-stars.png',  // 3 stars
      'four-stars.png',   // 4 stars
      'five-stars.png',   // 5 stars
      'six-stars.png'     // 6 stars
    ];

    // Wait for the SVG to load
    const objectElement = document.getElementById('starMap');
    objectElement.addEventListener('load', () => {
      let svgDoc = objectElement.contentDocument;
      const checkSvgDoc = setInterval(() => {
        svgDoc = objectElement.contentDocument;
        if (svgDoc) {
          clearInterval(checkSvgDoc);
          initializeSvg(svgDoc);
        } else {
          console.error('SVG document not loaded yet');
        }
      }, 100);
    });

    // Log if the load event fails to fire
    setTimeout(() => {
      if (!objectElement.contentDocument) {
        console.error('SVG load event did not fire or SVG failed to load. Check file path, server setup, and SVG syntax.');
      }
    }, 10000);

    function initializeSvg(svgDoc) {
      const line1 = svgDoc.getElementById('line1');
      if (!line1) {
        console.error('Line1 not found in SVG');
        return;
      }

      const star111 = svgDoc.getElementById('star-1-1-1');
      if (!star111) {
        console.error('Star-1-1-1 not found in SVG');
        return;
      }

      // Get the initial level from LocalStorage
      let level = parseInt(localStorage.getItem('exercise1:1:1')) || 0;
      star111.setAttributeNS('http://www.w3.org/1999/xlink', 'href', starImages[level]);

      // Apply glow and color based on initial level
      if (level === 6) {
        line1.setAttribute('filter', 'url(#golden-glow)');
        line1.style.stroke = '#FFD700';
        line1.setAttribute('stroke', '#FFD700');
        console.log('Initial glow and gold color applied to line1:', line1.getAttribute('filter'), line1.style.stroke, line1.getAttribute('stroke'));
      } else {
        line1.removeAttribute('filter');
        line1.style.stroke = '#FFFFFF';
        line1.setAttribute('stroke', '#FFFFFF');
        console.log('Initial glow removed and color set to white for line1:', line1.getAttribute('filter'), line1.style.stroke, line1.getAttribute('stroke'));
      }

      // Add click event to star-1-1-1
      star111.style.cursor = 'pointer';
      star111.addEventListener('click', () => {
        level = (level + 1) % 7;
        star111.setAttributeNS('http://www.w3.org/1999/xlink', 'href', starImages[level]);
        // Save the level to LocalStorage
        localStorage.setItem('exercise1:1:1', level);
        // Apply or remove glow and stroke color based on level
        if (level === 6) {
          line1.setAttribute('filter', 'url(#golden-glow)');
          line1.style.stroke = '#FFD700';
          line1.setAttribute('stroke', '#FFD700');
          console.log('Glow and gold color applied to line1:', line1.getAttribute('filter'), line1.style.stroke, line1.getAttribute('stroke'));
        } else {
          line1.removeAttribute('filter');
          line1.style.stroke = '#FFFFFF';
          line1.setAttribute('stroke', '#FFFFFF');
          console.log('Glow removed and color reverted to white for line1:', line1.getAttribute('filter'), line1.style.stroke, line1.getAttribute('stroke'));
        }
        console.log(`Star-1-1-1 clicked, level: ${level}, glow ${level === 6 ? 'applied' : 'removed'}`);
      });

      // Listen for storage events to sync with other pages
      window.addEventListener('storage', (event) => {
        if (event.key === 'exercise1:1:1') {
          level = parseInt(event.newValue) || 0;
          star111.setAttributeNS('http://www.w3.org/1999/xlink', 'href', starImages[level]);
          if (level === 6) {
            line1.setAttribute('filter', 'url(#golden-glow)');
            line1.style.stroke = '#FFD700';
            line1.setAttribute('stroke', '#FFD700');
            console.log('Glow and gold color applied to line1 (via storage event):', line1.getAttribute('filter'), line1.style.stroke, line1.getAttribute('stroke'));
          } else {
            line1.removeAttribute('filter');
            line1.style.stroke = '#FFFFFF';
            line1.setAttribute('stroke', '#FFFFFF');
            console.log('Glow removed and color reverted to white for line1 (via storage event):', line1.getAttribute('filter'), line1.style.stroke, line1.getAttribute('stroke'));
          }
          console.log(`Star-1-1-1 updated via storage event, level: ${level}, glow ${level === 6 ? 'applied' : 'removed'}`);
        }
      });
    }
  </script>
</body>
</html>